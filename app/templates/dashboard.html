{% extends 'base.html' %}
{% block container_class %}main-container{% endblock %}
{% block content %}
<div>
    <div class="card-container">
        <div class="card blue">
            <h3>üí∞ –ü–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å</h3>
            <p><strong>{{ "%.2f"|format(balance) }} –≥—Ä–Ω</strong></p>
        </div>
    
        <div class="card green recent-transactions-card">
            <div class="card-header">
                <h3>üìã –û—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h3>
                <a href="{{ url_for('transactions.list_transactions') }}" class="small-btn">–í—Å—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</a>
            </div>
            <ul class="recent-list">
                {% for t in last_transactions %}
                    <li>
                        <span class="type-label {{ 'income' if t.type == 'income' else 'expense' }}">
                            {{ '–î–æ—Ö—ñ–¥' if t.type == 'income' else '–í–∏—Ç—Ä–∞—Ç–∞' }}
                        </span>
                        <span class="date">{{ t.date }}</span>
                        {% if t.category %}
                            <span class="category">‚Äì {{ t.category.name }}</span>
                        {% endif %}
                        <span class="amount">‚Äì {{ "%.2f"|format(t.amount) }} –≥—Ä–Ω</span>
                    </li>
                {% else %}
                    <li><em>–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤</em></li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="card orange">
            <div class="card-header">
                <h3>üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏—Ç—Ä–∞—Ç</h3>
                <a href="{{ url_for('categories.index') }}" class="btn-small-link">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</a>
            </div>
            <div class="chart-wrapper">
                <canvas id="expensesChart"></canvas>
            </div>
        </div>

        <div class="card lightblue">
            <h3>üìà –î–∏–Ω–∞–º—ñ–∫–∞ –±–∞–ª–∞–Ω—Å—É</h3>
            <div class="chart-wrapper">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>
        <a href="{{ url_for('transactions.add_transaction') }}" class="fab"></a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const ctxPie = document.getElementById('expensesChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: {{ chart_labels|default([])|tojson }},
                    datasets: [{
                        label: '–í–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö',
                        data: {{ chart_values|default([])|tojson }},
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
    
            const ctxLine = document.getElementById('balanceChart').getContext('2d');
            new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: {{ trend_labels|tojson }},
                    datasets: [{
                        label: '–ë–∞–ª–∞–Ω—Å (–≥—Ä–Ω)',
                        data: {{ trend_values|tojson }},
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.2)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
    
</div>
{% endblock %}
